<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>POWER SHUTDOWN MANAGEMENT ‚Äì AREA IV</title>

<style>
body{font-family:Segoe UI,Arial;background:#f1f3f6;margin:0}
header{background:#1f3a5f;color:#fff;padding:14px;font-size:18px;font-weight:700;text-align:center}
.container{max-width:480px;margin:auto;padding:16px}
.card{background:#fff;padding:16px;border-radius:14px;margin-bottom:14px}
.hidden{display:none}
input,select,textarea,button{
 width:100%;padding:12px;margin-top:10px;
 border-radius:10px;border:1px solid #ccc;font-size:15px
}
button{border:none;font-weight:700;cursor:pointer}
.btn-login{background:#1f3a5f;color:#fff}
.btn-shutdown{background:#e74c3c;color:#fff}
.btn-resume{background:#27ae60;color:#fff}
.btn-back{background:#7f8c8d;color:#fff}
.btn-wa{background:#25D366;color:#fff}
#msg{text-align:center;font-weight:700;margin-top:10px}
</style>
</head>

<body>
<header>POWER SHUTDOWN MANAGEMENT APP ‚Äì AREA IV</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
<h3 style="text-align:center">USER LOGIN</h3>
<input id="loginUser" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button class="btn-login" onclick="login()">Login</button>
</div>

<!-- MAIN -->
<div class="card hidden" id="mainBox">
<h3 style="text-align:center">MAIN MENU</h3>
<button class="btn-shutdown" onclick="openShutdown()">‚ûï Shutdown Entry</button>
<button class="btn-resume" onclick="openResume()">‚úÖ Resume Entry</button>
</div>

<!-- SHUTDOWN -->
<div class="card hidden" id="shutdownBox">
<h3>Shutdown Entry</h3>
<select id="sd_feeder">
<option value="">Select Feeder</option>
<option>AKASH CERAMIC FEEDER</option>
<option>ITLA ONGC FEEDER-LG1</option>
</select>
<input type="datetime-local" id="sd_time">
<select id="sd_type">
<option value="">Select Type</option>
<option>PLAN PSD</option>
<option>UNPLAN PSD</option>
</select>
<textarea id="sd_info" placeholder="Information"></textarea>

<button class="btn-shutdown" onclick="submitShutdown()">Submit Shutdown</button>
<button class="btn-wa hidden" id="sdWaBtn" onclick="shareShutdown()">üì≤ Share on WhatsApp</button>
<button class="btn-back" onclick="back()">Back</button>
</div>

<!-- RESUME -->
<div class="card hidden" id="resumeBox">
<h3>Resume Entry</h3>
<select id="rs_feeder">
<option value="">Select Feeder</option>
<option>AKASH CERAMIC FEEDER</option>
<option>ITLA ONGC FEEDER-LG1</option>
</select>
<input type="datetime-local" id="rs_time">
<input id="rs_loss" placeholder="Production Loss">
<input id="rs_dg" placeholder="DG Deployed">
<textarea id="rs_rem" placeholder="Actual Reason"></textarea>

<button class="btn-resume" onclick="submitResume()">Submit Resume</button>
<button class="btn-wa hidden" id="rsWaBtn" onclick="shareResume()">üì≤ Share on WhatsApp</button>
<button class="btn-back" onclick="back()">Back</button>
</div>

<div id="msg"></div>
</div>

<script>
/* ================= CONFIG ================= */
const WEBAPP_URL =
"https://script.google.com/macros/s/AKfycbyx7kSp2pxjpS3X3155p4K5bUq92dLE-EfXnee6ZyR6WgnLwUoidwLfW06d1aZffjs6XA/exec";

/* ================= STATE ================= */
let CURRENT_USER = null;
let LAST_SD = null;
let LAST_RS = null;

/* ================= LOGIN ================= */
function login(){
 if(loginUser.value==="121318" && loginPass.value==="admin123"){
  CURRENT_USER="ADMIN";
  loginBox.classList.add("hidden");
  mainBox.classList.remove("hidden");
  msg("‚úÖ Login successful");
 } else {
  msg("‚ùå Invalid login");
 }
}

/* ================= NAV ================= */
function openShutdown(){
 mainBox.classList.add("hidden");
 shutdownBox.classList.remove("hidden");
}
function openResume(){
 mainBox.classList.add("hidden");
 resumeBox.classList.remove("hidden");
}
function back(){
 shutdownBox.classList.add("hidden");
 resumeBox.classList.add("hidden");
 mainBox.classList.remove("hidden");
}
function msg(t){
 document.getElementById("msg").innerText=t;
}

/* ================= SHUTDOWN ================= */
function submitShutdown(){
 if(!sd_feeder.value||!sd_time.value||!sd_type.value||!sd_info.value){
  msg("‚ùå Fill all shutdown fields"); return;
 }
 LAST_SD={
  feeder:sd_feeder.value,
  time:sd_time.value.replace("T"," "),
  type:sd_type.value,
  info:sd_info.value
 };

 fetch(WEBAPP_URL+"?"+new URLSearchParams({
  action:"shutdown",
  feeder:LAST_SD.feeder,
  ShutdownTime:LAST_SD.time,
  ShutdownType:LAST_SD.type,
  Information:LAST_SD.info,
  ShutdownEntryBy:CURRENT_USER,
  Installation:"ALL"
 }),{mode:"no-cors"});

 document.getElementById("sdWaBtn").classList.remove("hidden");
 msg("‚úÖ Shutdown submitted");
}

function shareShutdown(){
 const d=LAST_SD;
 window.open(
  "https://wa.me/?text="+encodeURIComponent(
   "‚ö° POWER SHUTDOWN\n\n"+
   "Feeder: "+d.feeder+
   "\nTime: "+d.time+
   "\nType: "+d.type+
   "\nInfo: "+d.info
  ),"_blank"
 );
}

/* ================= RESUME ================= */
function submitResume(){
 if(!rs_feeder.value||!rs_time.value||!rs_loss.value||!rs_dg.value||!rs_rem.value){
  msg("‚ùå Fill all resume fields"); return;
 }
 LAST_RS={
  feeder:rs_feeder.value,
  time:rs_time.value.replace("T"," "),
  loss:rs_loss.value,
  dg:rs_dg.value,
  rem:rs_rem.value
 };

 fetch(WEBAPP_URL+"?"+new URLSearchParams({
  action:"resume",
  feeder:LAST_RS.feeder,
  ResumeTime:LAST_RS.time,
  ResumeEntryBy:CURRENT_USER,
  TotalProdLoss:LAST_RS.loss,
  DGDeployed:LAST_RS.dg,
  Remarks:LAST_RS.rem
 }),{mode:"no-cors"});

 document.getElementById("rsWaBtn").classList.remove("hidden");
 msg("‚úÖ Resume submitted");
}

function shareResume(){
 const d=LAST_RS;
 window.open(
  "https://wa.me/?text="+encodeURIComponent(
   "‚úÖ POWER RESUME\n\n"+
   "Feeder: "+d.feeder+
   "\nTime: "+d.time+
   "\nLoss: "+d.loss+
   "\nDG: "+d.dg+
   "\nReason: "+d.rem
  ),"_blank"
 );
}
</script>
</body>
</html>
