<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>POWER SHUTDOWN MANAGEMENT APP - AREA-IV</title>

<style>
body{
  font-family:"Segoe UI",Roboto,Arial;
  background:#f1f3f6;
  margin:0;
}
header{
  background:#1f3a5f;
  color:#fff;
  padding:14px 18px;
  font-size:18px;
  font-weight:600;
  text-align:center;
}
.container{
  padding:16px;
  max-width:480px;
  margin:auto;
}
.card{margin-bottom:20px}
h2,h3{
  margin:12px 0;
  color:#1f3a5f;
  text-align:center;
}
input,select,textarea{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #dcdfe4;
  font-size:15px;
}
button{
  width:100%;
  padding:14px;
  margin-top:14px;
  font-size:16px;
  font-weight:600;
  border:none;
  border-radius:14px;
  cursor:pointer;
}
.btn-login{background:#1f3a5f;color:#fff}
.btn-shutdown{background:#e74c3c;color:#fff}
.btn-resume{background:#27ae60;color:#fff}
.btn-back{background:#7f8c8d;color:#fff}
.hidden{display:none}
.shutdown-item{
  background:#fff;
  border-radius:16px;
  padding:18px;
  margin-bottom:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}
.shutdown-row{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
  font-size:14px;
}
.shutdown-label{color:#6b7280;font-weight:600}
.shutdown-value{font-weight:700}
.install-badge{
  padding:4px 12px;
  border-radius:999px;
  background:#e5f0ff;
  color:#1f3a5f;
  font-size:12px;
  font-weight:700;
}
#msg{text-align:center;margin-top:10px;font-weight:600}
</style>
</head>

<body>

<header>POWER SHUTDOWN MANAGEMENT APP - AREA-IV</header>

<div id="userInfo" class="hidden" style="
  background:#ffffff;
  margin:10px 16px;
  padding:10px 14px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
  text-align:center;">
  <div id="ui_name" style="font-size:15px;font-weight:700;color:#1f3a5f"></div>
  <div id="ui_inst" style="font-size:13px;color:#6b7280"></div>
</div>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
  <div style="text-align:center;margin-bottom:12px;">
    <img src="Logo.png" alt="ONGC Logo"
     style="width:120px;background:#fff;padding:8px;border-radius:12px;
     box-shadow:0 4px 10px rgba(0,0,0,.15);">
  </div>
  <h3>USER LOGIN</h3>
  <input id="loginUser" placeholder="Username">
  <input id="loginPass" type="password" placeholder="Password">
  <button class="btn-login" onclick="login()">Login</button>
</div>

<!-- MAIN -->
<div class="card hidden" id="mainBox">
  <h2>ACTIVE SHUTDOWN FEEDERS</h2>
  <div id="activeShutdowns">Loading...</div>
  <button class="btn-shutdown" onclick="openShutdown()">Shutdown</button>
  <button class="btn-resume" onclick="openResume()">Resume</button>
</div>

<!-- SHUTDOWN -->
<div class="card hidden" id="shutdownBox">
  <h3>Shutdown Entry</h3>
  <select id="sd_feeder"></select>
  <input type="datetime-local" id="sd_time">
  <select id="sd_type">
    <option value="">Select Type</option>
    <option>PLAN PSD</option>
    <option>PARTIAL PLAN PSD</option>
    <option>UNPLAN PSD</option>
    <option>PARTIAL UNPLAN PSD</option>
  </select>
  <textarea id="sd_info" placeholder="Information"></textarea>
  <button class="btn-shutdown" onclick="submitShutdown()">Submit</button>
  <button class="btn-back" onclick="backToMain()">Back</button>
</div>

<!-- RESUME -->
<div class="card hidden" id="resumeBox">
  <h3>Resume Entry</h3>
  <select id="rs_feeder"></select>
  <input type="datetime-local" id="rs_time">
  <input type="number" id="rs_loss" placeholder="Production Loss" min="0">
  <input type="number" id="rs_dg" placeholder="DG Deployed" min="0">
  <textarea id="rs_rem" placeholder="Actual Reason"></textarea>

  <button class="btn-resume" onclick="submitResume()">Submit</button>
  <button id="resumeShareBtn" class="btn-resume hidden" onclick="shareResumeWhatsApp()">ðŸ“² Share Resume on WhatsApp</button>
  <button class="btn-back" onclick="backToMain()">Back</button>
</div>

<div id="msg"></div>
</div>

<script>
const WEBAPP_URL="https://script.google.com/macros/s/AKfycbyx7kSp2pxjpS3X3155p4K5bUq92dLE-EfXnee6ZyR6WgnLwUoidwLfW06d1aZffjs6XA/exec";
const CSV_URL="https://docs.google.com/spreadsheets/d/1NLMcoIjlo5elmrALUXPfvGOEqToS8tFPfGThRZ8maiU/export?format=csv";

const USERS=[
 {u:"121318",p:"admin123",n:"SYSTEM ADMIN",i:"ALL",admin:true},
 {u:"95606",p:"*ongc123",n:"SUDHIR SINGH",i:"ALL",admin:true},
 {u:"95843",p:"*ongc123",n:"DIPAK MEDAK",i:"ALL",admin:true},
 {u:"82653",p:"*ongc123",n:"SHANTILAL RATHWA",i:"ALL",admin:true},
 {u:"82051",p:"*ongc123",n:"HEMENDRA KUMAR",i:"ALL",admin:true},
 {u:"124569",p:"1234",n:"KULDIP KHAROLIA",i:"LIMBODARA-GGS-1"},
 {u:"133668",p:"1234",n:"DIPAK MAURYA",i:"LIMBODARA-GGS-1"},
 {u:"124470",p:"1234",n:"SANDESH BHARDWAJ",i:"LIMBODARA-GGS-2"},
 {u:"135597",p:"1234",n:"KUNAL RANJAN",i:"LIMBODARA-GGS-2"},
 {u:"139938",p:"1234",n:"HAREKRISHNA",i:"LIMBODARA-GGS-2"},
 {u:"125223",p:"1234",n:"SUKUMAR LAHA",i:"GAMIJ-GGS-1"},
 {u:"139646",p:"1234",n:"RAVI KUMAR SHARMA",i:"GAMIJ-GGS-1"},
 {u:"137317",p:"1234",n:"SONUKUMAR SINGH",i:"GAMIJ-GGS-1"},
 {u:"121028",p:"1234",n:"ABHISHEK PATEL",i:"GAMIJ-GGS-2"},
 {u:"133181",p:"1234",n:"KETUL PATEL",i:"GAMIJ-GGS-2"},
 {u:"123310",p:"1234",n:"DHEERENDRA SINGH",i:"GAMIJ-GGS-3"},
 {u:"133643",p:"1234",n:"ASHUTOSH KUMAR SINGH",i:"GAMIJ-GGS-3"},
 {u:"135515",p:"1234",n:"ADITYA ARYA",i:"GAMIJ-GGS-3"},
 {u:"130594",p:"1234",n:"MAHESH GAJJAR",i:"MOTERA-GGS"}
];

const FEEDERS={
 "LIMBODARA-GGS-1":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER-LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER"],
"LIMBODARA-GGS-2":["ITLA ONGC FEEDER-LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER","MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER"],
"GAMIJ-GGS-1":["BAHIYAL ONGC FEEDER","RAM FEEDER-GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER","VASNA RATHOD FEEDER"],
"GAMIJ-GGS-2":["BADARPUR FEEDER","CHAULAJ FEEDER-GAMIJ-2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2"],
"GAMIJ-GGS-3":["BADARPUR FEEDER","CHAULAJ FFEDER-GAMIJ-2","GADWEL FEEDER","KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2","BARMUVADA FEEDER","CHAULAJ FEEDER-GAMIJ-3","FINAV FEEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER","GINJAR FEEDER","HALDARWAS FEEDER-GAMIJ-3","HALDARWAS FEEDER-GAMIJ-4","KALPSAR FEEDER","SATRUNDA FEEDER-GAMIJ-3","SATRUNDA FEEDER-GAMIJ-4","SIHUNJ FEEDER","VANSOLI FEEDER"],
"MOTERA-GGS":["PREKSHA BHARTI INFOCITY FEEDER","TP-44 FEEDER","ZUNDAL AG FEEDER"],
"ALL":["AKASH CERAMIC FEEDER","ITLA ONGC FEEDER-LG1","MANSA CITY FEEDER","MANSA CIVIL FEEDER",
 "ITLA ONGC FEEDER-LG2","KIRTIDHAM FEEDER","LISA FEEDER","MAHAKALI FEEDER",
 "MUBARAKPUR FEEDER","NETRA FEEDER","ROYAL FEEDER","TIRUPATI FEEDER","VARDAYINI FEEDER",
 "BAHIYAL ONGC FEEDER","RAM FEEDER-GAMIJ-1","SOMNATH JGY FEEDER","NAYRA JGY FEEDER",
 "VASNA RATHOD FEEDER","BADARPUR FEEDER","CHAULAJ FFEDER-GAMIJ-2","GADWEL FEEDER",
 "KASHTABHANJAN FEEDER","RAM FEEDR-GAMIJ-2","BARMUVADA FEEDER",
 "CHAULAJ FEEDER-GAMIJ-3","FINAV FEEEDER","FUDAL MATA FEEDER","GAYATRI FEEDER",
 "GINJAR FEEDER","HALDARWAS FEEDER-GAMIJ-3","HALDARWAS FEEDER-GAMIJ-4",
 "KALPSAR FEEDER","SATRUNDA FEEDER-GAMIJ-3","SATRUNDA FEEDER-GAMIJ-4",
 "SIHUNJ FEEDER","VANSOLI FEEDER",
 "PREKSHA BHARTI INFOCITY FEEDER","TP-44 FEEDER","ZUNDAL AG FEEDER"
]
};

let CURRENT_USER={}, LAST_SHUTDOWN_TIME={}, LAST_RESUME_DATA=null;

function hasSpecialChar(t){
  return !/^[a-zA-Z0-9 \-/]+$/.test(t);
}

/* ---------- LOGIN ---------- */
function login(){
 const u=USERS.find(x=>x.u===loginUser.value && x.p===loginPass.value);
 if(!u){showMsg("Invalid Login");return;}
 CURRENT_USER=u;
 ui_name.innerText="ðŸ‘¤ "+u.n;
 ui_inst.innerText="Installation : "+u.i;
 userInfo.classList.remove("hidden");
 loginBox.classList.add("hidden");
 mainBox.classList.remove("hidden");
 populateFeeders();
 loadActiveShutdowns();
}

/* ---------- COMMON ---------- */
function populateFeeders(){
 sd_feeder.innerHTML=rs_feeder.innerHTML="";
 (FEEDERS[CURRENT_USER.i]||FEEDERS.ALL).forEach(f=>{
  sd_feeder.innerHTML+=`<option>${f}</option>`;
  rs_feeder.innerHTML+=`<option>${f}</option>`;
 });
}
function showMsg(t){msg.innerText=t;setTimeout(()=>msg.innerText="",3000);}

/* ---------- NAV ---------- */
function openShutdown(){mainBox.classList.add("hidden");shutdownBox.classList.remove("hidden")}
function openResume(){mainBox.classList.add("hidden");resumeBox.classList.remove("hidden");resumeShareBtn.classList.add("hidden")}
function backToMain(){shutdownBox.classList.add("hidden");resumeBox.classList.add("hidden");mainBox.classList.remove("hidden");loadActiveShutdowns()}

/* ---------- INPUT SANITIZE ---------- */
document.querySelectorAll("textarea,input[type=text]").forEach(el=>{
 el.addEventListener("input",()=>el.value=el.value.replace(/[^a-zA-Z0-9 \-/]/g,""));
});
</script>

</body>
</html>
